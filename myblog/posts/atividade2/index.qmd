---
title: "Atividade 2 - Monitoramento de Frota de Ônibus"
author: "Beatriz Lucena"
date: "2025-11-19"
categories: [code, analysis]
image: "parada.png"
jupyter: python3

---

# Introdução
Nesta atividade implementei um sistema simples de monitoramento de frota utilizando a API Olho Vivo da SPTrans. O código realiza autenticação, consulta paradas e posições de ônibus de uma linha específica e exibe tudo em um mapa interativo gerado com Folium.

O exercício permitiu praticar chamadas reais a APIs REST, manipulação de dados retornados em JSON e visualização geográfica com marcadores personalizados. Foi útil para entender melhor o fluxo de autenticação, requisições consecutivas e integração entre dados dinâmicos e mapas.

```{python}
import requests
from folium import Map, Marker, Icon

BASE_URL = "http://api.olhovivo.sptrans.com.br/v2.1"

token = "8a7d9519cf4e8aca8da1494631030a5ac561326041a8ee9dcfef1a8dfdeeac94"

# Criar sessão 
s = requests.Session()

# ---- autenticação -------
def autenticar():
    url = f"{BASE_URL}/Login/Autenticar?token={token}"
    r = s.post(url)
    print("Autenticado?", r.json())

def buscar_paradas(codigo_linha):
    autenticar()
    url = f"{BASE_URL}/Parada/BuscarParadasPorLinha?codigoLinha={codigo_linha}"
    r = s.get(url)
    if r.status_code != 200:
        print("Erro:", r.status_code)
        return []
    return r.json()

def buscar_posicoes(codigo_linha):
    autenticar()
    url = f"{BASE_URL}/Posicao/Linha?codigoLinha={codigo_linha}"
    r = s.get(url)
    dados = r.json()
    
    if "vs" in dados:
        return dados["vs"]
    return []

def construir_mapa(paradas, onibus):
    if not paradas:
        return "Sem paradas!"

    # centralizar no 3º ponto como na aula (mas seguro)
    centro = [paradas[0]["py"], paradas[0]["px"]]

    m = Map(location=centro, zoom_start=14)

    # ---- adicionar paradas (azul) ----
    for p in paradas:
        Marker(
            location=[p["py"], p["px"]],
            popup=p["np"],
            icon=Icon(color="blue")
        ).add_to(m)

    # ---- adicionar ônibus (vermelho) ----
    for v in onibus:
        Marker(
            location=[v["py"], v["px"]],
            popup=f"Ônibus {v['p']}",
            icon=Icon(color="red")
        ).add_to(m)

    return m

```

```{python}
codigo = 1273 

paradas = buscar_paradas(codigo)
print("Paradas encontradas:", len(paradas))

onibus = buscar_posicoes(codigo)
print("Ônibus encontrados:", len(onibus))

m = construir_mapa(paradas, onibus)
m

```